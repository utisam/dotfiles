#!/bin/zsh

SILENT=0
if [[ $1 = "-s" ]]; then
    shift
    SILENT=1
fi

declare -a COMMAND=(git --no-pager $argv)
if [[ $1 = "!" ]]; then
    shift
    COMMAND=($argv)
fi

for D in $(find -L $PWD \( -name vendor -o -name node_modules \) -prune -o -type d -name .git -print -prune)
do
    cd $(dirname $D)
    [[ $SILENT = 0 ]] && echo -e "\e[37;44;1m${PWD/${HOME}/~}\e[m"
    $COMMAND[*]
done
